<div class="seasonality-container">
  <!-- Loading Overlay -->
  <div *ngIf="isLoading$ | async" class="page-loading-overlay" role="status" aria-live="polite">
    <div class="loading-content">
      <mat-spinner diameter="60" aria-label="Loading market data"></mat-spinner>
      <h3>Analyzing Market Data</h3>
      <p>Please wait while we process seasonal patterns...</p>
    </div>
  </div>


  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Charts Section -->
    <section class="charts-section" aria-label="Market seasonality charts">
      <div class="square-container chart-box" role="region" aria-label="Market seasonality chart">
        <div class="box-content">
          <app-chart-year-component (valueChanged)="handleValueChanged($event)" aria-label="Interactive chart component">
          </app-chart-year-component>
        </div>
      </div>
    </section>

    <!-- Weekday Returns Analysis Section -->
    <section class="weekday-returns-section" aria-label="Weekday returns analysis">
      <div class="weekday-charts-grid">
        <!-- Weekly Weekday Returns Chart -->
        <app-weekday-returns-chart
          *ngIf="weekdayReturnsRequest"
          [request]="weekdayReturnsRequest"
          [config]="{
            title: 'Average Returns by Weekday',
            subtitle: 'Weekly trading performance analysis',
            showStats: true,
            height: '350px',
            colorScheme: 'performance'
          }"
          aria-label="Weekly weekday returns chart">
        </app-weekday-returns-chart>

        <!-- Monthly Weekday Returns Chart -->
        <app-monthly-weekday-returns-chart
          *ngIf="weekdayReturnsRequest"
          [request]="weekdayReturnsRequest"
          [config]="{
            title: 'Monthly Weekday Analysis',
            subtitle: 'Average returns by month and weekday',
            showStats: true,
            height: '350px',
            colorScheme: 'heatmap'
          }"
          aria-label="Monthly weekday returns chart">
        </app-monthly-weekday-returns-chart>
      </div>
    </section>

    <!-- Dynamic Analysis Section -->
    <aside class="analysis-sidebar" aria-label="Market analysis sidebar">
      <div class="square-container analysis-box" role="region" aria-label="Market analysis panel">
        <div class="box-header">
          <div class="header-title">
            <mat-icon aria-label="Analytics icon">analytics</mat-icon>
            <h2>Market Analysis</h2>
          </div>
          <p class="header-subtitle">Detailed insights for {{ selectedStockSymbol }}</p>
        </div>

        <div class="box-content">
          <div class="dynamic-content-wrapper">
            <ng-template #dynamicInsert></ng-template>

            @if (!hasDynamicContent) {
            <div class="empty-analysis" role="status" aria-live="polite">
              <mat-icon class="empty-icon" aria-label="Insights icon">insights</mat-icon>
              <h3>No Analysis Available</h3>
              <p>Select a different symbol to view detailed market analysis and insights.</p>
            </div>
            }
          </div>

          @if (errorMessage) {
          <div class="error-message" role="alert" aria-live="assertive">
            <mat-icon aria-label="Error icon">error_outline</mat-icon>
            <p>{{ errorMessage }}</p>
            <button class="btn-primary" (click)="refreshData()" aria-label="Try again button">Try Again</button>
          </div>
          }
        </div>
      </div>

      <!-- Quick Stats Box -->
      <div class="square-container stats-box" role="region" aria-label="Quick statistics">
        <div class="stats-grid">
          <div class="stat-item" role="listitem">
            <mat-icon class="stat-icon" aria-label="Calendar icon">calendar_today</mat-icon>
            <div class="stat-content">
              <span class="stat-label">Current Month</span>
              <span class="stat-value">{{ getCurrentMonthName() }}</span>
            </div>
          </div>
          <div class="stat-item" role="listitem">
            <mat-icon class="stat-icon" aria-label="Chart icon">show_chart</mat-icon>
            <div class="stat-content">
              <span class="stat-label">Symbol</span>
              <span class="stat-value">{{ valueChanged }}</span>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </main>
</div>
